var PermissionsTree=function(e){return function(){var t;return{init:function(n,r){t=n,initialized=!1;var s,i={types:{default:{icon:"fa fa-folder text-warning"},file:{icon:"fa fa-file text-warning"}},checkbox:{keep_selected_style:!1,three_state:!1,cascade:""},search:{show_only_matches:!0},plugins:["checkbox","types","search"]};r&&r.singleSelect&&!0===r.singleSelect&&e.extend(i,{core:{multiple:!1}}),t.jstree(i),r&&(r.singleSelect&&!0===r.singleSelect||r.disableCascade&&!0===r.disableCascade)||t.on("changed.jstree",function(n,r){var s;r.node&&(r.node.state.selected?(function e(n){t.jstree("select_node",n,!0);var r=t.jstree("get_parent",n);r&&e(r)}(t.jstree("get_parent",r.node)),s=e.makeArray(t.jstree("get_node",r.node).children),t.jstree("select_node",s)):(s=e.makeArray(t.jstree("get_node",r.node).children),t.jstree("deselect_node",s)))}),s=!1,e("#PermissionTreeFilter").keyup(function(){s&&clearTimeout(s),s=setTimeout(function(){var n=e("#PermissionTreeFilter").val();t.jstree(!0)&&t.jstree(!0).search(n)},250)})},getSelectedPermissionNames:function(){for(var e=[],n=t.jstree("get_selected",!0),r=0;r<n.length;r++)e.push(n[r].id);return e}}}}(jQuery);
app.modals.PermissionTreeModal=function(){var e,o=null,n={onSelectionDone:function(){}};this.init=function(i){e=i,n=$.extend(n,e.getOptions().options),(o=new PermissionsTree).init(e.getModal().find("#PermissionFilterTree .permission-tree"),e.getOptions().options),e.onBeforeClose(function(){"function"==typeof n.onSelectionDone&&n.onSelectionDone(o.getSelectedPermissionNames())})}},app.modals.PermissionTreeModal.create=function(e){return new app.ModalManager({viewUrl:abp.appPath+"App/Common/PermissionTreeModal",scriptUrl:abp.appPath+"view-resources/Areas/App/Views/Common/Modals/_PermissionTreeModal.js",modalClass:"PermissionTreeModal",options:e,removeAllOnCloseBindsAfterModalClose:!0})};
app.modals.CreateOrEditDynamicPropertyModal=function(){var e,a=abp.services.app.dynamicProperty,i=app.modals.PermissionTreeModal.create({singleSelect:!0,onSelectionDone:function(a){a&&a.length>0&&e.getModal().find("input[name=permission]").val(a[0])}});this.init=function(a){e=a},this.save=function(){var i={id:e.getModal().find("input[name=Id]").val(),propertyName:e.getModal().find("input[name=propertyName]").val(),displayName:e.getModal().find("input[name=displayName]").val(),permission:e.getModal().find("input[name=permission]").val(),inputType:e.getModal().find("select[name=inputType]").val()};""!==i.propertyName.trim()?(e.setBusy(!0),i.id?a.update(i).done(function(){abp.notify.info(app.localize("SavedSuccessfully")),e.close(),abp.event.trigger("app.createOrEditDynamicPropertyModalSaved")}).always(function(){e.setBusy(!1)}):a.add(i).done(function(){abp.notify.info(app.localize("SavedSuccessfully")),e.close(),abp.event.trigger("app.createOrEditDynamicPropertyModalSaved")}).always(function(){e.setBusy(!1)})):abp.notify.success(app.localize("XCanNotBeNullOrEmpty",app.localize("PropertyName")))},$("#FilterByPermissionsButton").click(function(){i.open({grantedPermissionNames:[]})})};
$(function(){var e,a=$("#DynamicPropertiesTable"),t=abp.services.app.dynamicProperty,i=!1,n={edit:abp.auth.hasPermission("Pages.Administration.DynamicProperties.Edit"),delete:abp.auth.hasPermission("Pages.Administration.DynamicProperties.Delete"),dynamicPropertyValue_edit:abp.auth.hasPermission("Pages.Administration.DynamicPropertyValue.Edit")},r=new app.ModalManager({viewUrl:abp.appPath+"App/DynamicProperty/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/App/Views/DynamicProperties/_CreateOrEditModal.js",modalClass:"CreateOrEditDynamicPropertyModal",cssClass:"scrollable-modal"}),s=new app.ModalManager({viewUrl:abp.appPath+"App/DynamicProperty/ManageValuesModal",scriptUrl:abp.appPath+"view-resources/Areas/App/Views/_Bundles/dynamic-properties-manage-values.min.js",modalClass:"ManageDynamicPropertyValueModal",cssClass:"scrollable-modal"});function o(){i&&e.ajax.reload()}$("#CreateNewDynamicProperty").click(function(){r.open()}),$("#GetDynamicPropertiesButton").click(function(e){e.preventDefault(),o()}),abp.event.on("app.createOrEditDynamicPropertyModalSaved",function(){o()}),i||(i=!0,e=a.DataTable({paging:!1,serverSide:!1,processing:!1,listAction:{ajaxFunction:t.getAll},columnDefs:[{className:"control responsive",orderable:!1,render:function(){return""},targets:0},{targets:1,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{text:'<i class="fa fa-cog"></i> <span class="d-none d-md-inline-block d-lg-inline-block d-xl-inline-block">'+app.localize("Actions")+'</span> <span class="caret"></span>',items:[{text:app.localize("Edit"),visible:function(e){return n.edit},action:function(e){r.open({id:e.record.id})}},{text:app.localize("Delete"),visible:function(e){return n.delete},action:function(e){var a;a=e.record.id,abp.message.confirm(app.localize("DeleteDynamicPropertyMessage"),app.localize("AreYouSure"),function(e){e&&(abp.ui.setBusy(),t.delete(a).done(function(){o(),abp.notify.success(app.localize("SuccessfullyDeleted"))}).always(function(){abp.ui.clearBusy()}))})}},{text:app.localize("EditValues"),visible:function(e){var a=abp.inputTypeProviders.getInputTypeInstance(e.record.inputType);return n.dynamicPropertyValue_edit&&a.hasValues},action:function(e){s.open({id:e.record.id})}}]}},{targets:2,data:"propertyName"},{targets:3,data:"displayName"},{targets:4,data:"inputType"},{targets:5,data:"permission"}]}))});
function ShowDetailModal(e){var t=$("#"+e).text(),a=$("#SendAttemptDetailModal");a.find(".modal-body").text(t),a.modal("show")}$(function(){var e=$("#WebHookSendAttemptTable"),t=abp.services.app.webhookSubscription,a=abp.services.app.webhookSendAttempt,i={create:abp.auth.hasPermission("Pages.Administration.WebhookSubscription.Create"),edit:abp.auth.hasPermission("Pages.Administration.WebhookSubscription.Edit"),changeActivity:abp.auth.hasPermission("Pages.Administration.WebhookSubscription.ChangeActivity"),detail:abp.auth.hasPermission("Pages.Administration.WebhookSubscription.Detail"),list:abp.auth.hasPermission("Pages.Administration.Webhook.ListSendAttempts"),resend:abp.auth.hasPermission("Pages.Administration.Webhook.ResendWebhook")},o=new app.ModalManager({viewUrl:abp.appPath+"App/WebhookSubscription/EditModal",scriptUrl:abp.appPath+"view-resources/Areas/App/Views/WebhookSubscriptions/_CreateOrEditModal.js",modalClass:"CreateOrEditWebhookSubscriptionModal",cssClass:"scrollable-modal"}),n=e.DataTable({paging:!0,serverSide:!0,processing:!1,listAction:{ajaxFunction:a.getAllSendAttempts,inputFilter:function(){return{subscriptionId:subscriptionData.Id}}},columnDefs:[{className:"control responsive",orderable:!1,render:function(){return""},targets:0},{targets:1,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{text:'<i class="fa fa-cog"></i><span class="caret"></span>',items:[{text:app.localize("Resend"),visible:function(e){return i.resend},action:function(e){var t;t=e.record.id,abp.message.confirm(app.localize("WebhookEventWillBeSendWithSameParameters"),app.localize("AreYouSure"),function(e){e&&(abp.ui.setBusy(),a.resend(t).done(function(){abp.notify.success(app.localize("WebhookSendAttemptInQueue"))}).always(function(){abp.ui.clearBusy()}))})}},{text:app.localize("ViewWebhookEvent"),action:function(e){window.location="/App/WebhookSubscription/WebhookEventDetail/"+e.record.webhookEventId}}]}},{targets:2,orderable:!1,data:"webhookName"},{targets:3,orderable:!1,data:"webhookEventId"},{targets:4,orderable:!1,data:"creationTime",render:function(e){return moment(e)}},{targets:5,orderable:!1,data:"responseStatusCode"},{targets:6,orderable:!1,data:"response",render:function(e){return r(e,100,app.localize("ShowResponse"))}},{targets:7,orderable:!1,data:"data",render:function(e){return r(e,100,app.localize("ShowData"))}}]});function s(){abp.message.confirm(subscriptionData.IsActive?app.localize("DeactivateSubscriptionWarningMessage"):app.localize("ActivateSubscriptionWarningMessage"),app.localize("AreYouSure"),function(e){e&&(abp.ui.setBusy(),t.activateWebhookSubscription({subscriptionId:subscriptionData.Id,isActive:!subscriptionData.IsActive}).done(function(){window.location.reload(),abp.notify.success(subscriptionData.IsActive?app.localize("SuccessfullyDeactivated"):app.localize("SuccessfullyActivated"))}).always(function(){abp.ui.clearBusy()}))})}function r(e,t,a){if("string"!=typeof e)return e;if(e.length<=t)return e;var i="detail-"+parseInt(1e7*Math.random())+parseInt(1e7*Math.random());return`<button class="btn btn-outline-primary btn-sm" onclick="ShowDetailModal('${i}')" >${a}</button>\n                    <div class="d-none" id= ${i}>${e}</div>`}$("#activity-toggle-btn").text(subscriptionData.IsActive?app.localize("Deactivate"):app.localize("Activate")),$("#activity-toggle-btn").click(function(){s()}),$("#subscription-edit-btn").click(function(){o.open({subscriptionId:subscriptionData.Id})}),$("#ToggleActivity").click(function(e){s()}),$("#secret-view-btn").click(function(e){$("#secretSpan").removeClass("blur"),$(this).remove()}),abp.event.on("app.createOrEditWebhookSubscriptionModalSaved",function(){window.location.reload()}),$("#refresh-send-attempts-btn").click(function(e){n.ajax.reload()})});
abp.inputTypeProviders=new function(){var e={};this.addInputTypeProvider=function(t){if(!t)throw new Error("Input type provider can not be null or undefined.");if("string"!=typeof t.name)throw new Error('Input type provider should have "name" property which is same unique name of InputType');if("function"!=typeof t.get)throw new Error('Input type provider should have "get" method which returns new manager for input type.');e[t.name]=t},this.getInputTypeInstance=function(t){if("string"==typeof t)return e[t].get();if("object"==typeof t&&"object"==typeof t.inputType){var n=e[t.inputType.name].get();return n.init(t.inputType,t.options),n}throw new Error("Parameter should be type of string (InputTypeName),or object which includes inputType and options")}};var SingleLineStringInputType=function(){var e,t,n;return{name:"SINGLE_LINE_STRING",init:function(n,a){e=n,t=a},getSelectedValues:function(){return[n.val()]},getView:function(a,i){var r="text";return e.validator&&"NUMERIC"==e.validator.name&&(r="number"),n=$('<input class="form-control" type="'+r+'" />').on("change",function(){t&&"function"==typeof t.onChange&&t.onChange(n.val())}),"number"==r?(n.attr("min",feature._inputType.validator.minValue),n.attr("max",feature._inputType.validator.maxValue)):e.validator&&"STRING"==e.validator.name&&(e.validator.maxLength>0&&n.attr("maxlength",e.validator.maxLength),e.validator.minLength>0&&n.attr("required","required"),e.validator.regularExpression&&n.attr("pattern",e.validator.regularExpression)),n.on("input propertychange paste",function(){!function(){if(value=n.val(),e||!e.validator)return!0;var t=e.validator;if("STRING"==t.name){if(null==value||null==value)return t.allowNull;if("string"!=typeof value)return!1;if(t.minLength>0&&value.length<t.minLength)return!1;if(t.maxLength>0&&value.length>t.maxLength)return!1;if(t.regularExpression)return new RegExp(t.regularExpression).test(value)}else if("NUMERIC"==t.name){var a=parseInt(value);if(isNaN(a))return!1;if(t.minValue>a)return!1;var i=t.maxValue;if(i>0&&a>i)return!1}return!0}()?n.addClass("input-textbox-invalid"):n.removeClass("input-textbox-invalid")}),a&&a.length>0&&n.val(a[0]),n[0]},hasValues:!1,afterViewInitialized:function(){}}};!function(){var e=new function(){this.name="SINGLE_LINE_STRING",this.get=function(){return new SingleLineStringInputType}};abp.inputTypeProviders.addInputTypeProvider(e)}();var ComboBoxInputType=function(){var e,t;return{name:"COMBOBOX",init:function(t,n){e=n},getSelectedValues:function(){return[t.val()]},getView:function(n,a){if(t=$('<select class="form-control" />'),$("<option></option>").appendTo(t),a&&a.length>0)for(var i=0;i<a.length;i++)$("<option></option>").attr("value",a[i]).text(a[i]).appendTo(t);return t.on("change",function(){e&&"function"==typeof e.onChange&&e.onChange(t.val())}),n&&n.length>0&&t.val(n[0]),t[0]},hasValues:!0,afterViewInitialized:function(){}}};!function(){var e=new function(){this.name="COMBOBOX",this.get=function(){return new ComboBoxInputType}};abp.inputTypeProviders.addInputTypeProvider(e)}();var CheckBoxInputType=function(){var e,t;return{name:"CHECKBOX",init:function(t,n){e=n},getSelectedValues:function(){return[t.prop("checked")]},getView:function(n,a){return $div=$('<div class="form-group checkbox-list">'),$label=$('<label class="checkbox">').appendTo($div),t=$('<input type="checkbox"/>').appendTo($label),$span=$("<span></span>").appendTo($label),t.on("change",function(){e&&"function"==typeof e.onChange&&e.onChange(t.val())}),n&&n.length>0&&t.prop("checked",n[0]),$div[0]},hasValues:!1,afterViewInitialized:function(){}}};!function(){var e=new function(){this.name="CHECKBOX",this.get=function(){return new CheckBoxInputType}};abp.inputTypeProviders.addInputTypeProvider(e)}();var MultiSelectComboBoxInputType=function(){var e,t;return{name:"MULTISELECTCOMBOBOX",init:function(t,n){e=n},getSelectedValues:function(){return t.val()},getView:function(n,a){if(t=$('<select class="form-control w-100" multiple/>'),a&&a.length>0)for(var i=0;i<a.length;i++){var r=$("<option></option>").attr("value",a[i]).text(a[i]);n&&n.length>0&&-1!==n.indexOf(a[i])&&r.attr("selected","selected"),r.appendTo(t)}return t.on("change",function(){e&&"function"==typeof e.onChange&&e.onChange(t.val())}),t[0]},hasValues:!0,afterViewInitialized:function(){t.select2({width:"100%"})}}};!function(){var e=new function(){this.name="MULTISELECTCOMBOBOX",this.get=function(){return new MultiSelectComboBoxInputType}};abp.inputTypeProviders.addInputTypeProvider(e)}();var ManageDynamicEntityPropertyValueBase=function(e){return function(){var t,n=abp.services.app.dynamicEntityPropertyValue,a=[],i={delete:abp.auth.hasPermission("Pages.Administration.DynamicEntityPropertyValue.Delete")};function r(a,r){var o=r.getView(a.selectedValues,a.allValuesInputTypeHas),u=e("<tr></tr>"),p=e("<td></td>");p.text(a.propertyName);var l=e("<td></td>").append(o);l.append(o);var c=e("<td></td>");if(i.delete){var s=e('<button class="btn btn-danger"></button>').text(app.localize("Delete")).click(function(){var e;e={dynamicPropertyName:a.dynamicPropertyName,dynamicEntityPropertyId:a.dynamicEntityPropertyId},abp.message.confirm(app.localize("DeleteDynamicEntityPropertyValueMessage",e.dynamicPropertyName),app.localize("AreYouSure"),function(a){a&&(abp.ui.setBusy(),n.cleanValues({dynamicEntityPropertyId:e.dynamicEntityPropertyId,entityId:t.entityId}).done(function(){abp.notify.success(app.localize("SuccessfullyDeleted")),"function"==typeof t.onDeleteValues&&t.onDeleteValues()}).always(function(){abp.ui.clearBusy()}))})});c.append(s)}return u.append(p),u.append(l),u.append(c),u}return{initialize:function(i){abp.ui.setBusy(),t=i,a=[],n.getAllDynamicEntityPropertyValues({entityFullName:i.entityFullName,entityId:i.entityId}).done(function(t){var n=e(i.bodyElement);if(!t||!t.items||0==t.items.length){var o=e("<tr></tr>"),u=e("<td class='text-center' colspan='3'></td>");return u.text(app.localize("ThereAreNoDynamicPropertiesMessage")),o.append(u),void n.append(o)}for(var p=0;p<t.items.length;p++){var l=t.items[p],c=abp.inputTypeProviders.getInputTypeInstance({inputType:l.inputType});n.append(r(l,c)),c.afterViewInitialized(),a.push({data:l,inputTypeManager:c})}}).always(function(){abp.ui.clearBusy()})},save:function(e){if(a){abp.ui.setBusy();for(var i=[],r=0;r<a.length;r++)i.push({entityId:t.entityId,dynamicEntityPropertyId:a[r].data.dynamicEntityPropertyId,values:a[r].inputTypeManager.getSelectedValues()});n.insertOrUpdateAllValues({Items:i}).done(function(){abp.notify.success(app.localize("SavedSuccessfully")),"function"==typeof e&&e()}).always(function(){abp.ui.clearBusy()})}}}}}(jQuery);app.modals.ManageDynamicEntityPropertyValuesModal=function(){var e,t=new ManageDynamicEntityPropertyValueBase;this.init=function(n){e=n,function n(){var a=e.getModal().find("#DynamicEntityPropertyValuesTable");a.find("tbody").empty(),t.initialize({entityFullName:e.getModal().find("#EntityFullName").val(),entityId:e.getModal().find("#EntityId").val(),bodyElement:a.find("tbody"),onDeleteValues:function(){n()}})}()},this.save=function(){t.save(function(){e.close()})}},app.modals.ManageDynamicEntityPropertyValuesModal.create=function(){return new app.ModalManager({viewUrl:abp.appPath+"App/DynamicEntityPropertyValue/ManageDynamicEntityPropertyValuesModal",scriptUrl:abp.appPath+"view-resources/Areas/App/Views/DynamicEntityPropertyValues/ManageDynamicEntityPropertyValuesModal.js",modalClass:"ManageDynamicEntityPropertyValuesModal",cssClass:"scrollable-modal"})};
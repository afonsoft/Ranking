app.modals.CreateOrEditWebhookSubscriptionModal=function(){var e,a=abp.services.app.webhookSubscription,i=new KeyValueListManager;this.init=function(a){var t,o;(e=a).getModal().find("#Webhooks").select2(),t=Object.keys(createOrEditHeaders),o=[],createOrEditHeaders&&t.length>0&&(o=t.map(e=>({key:e,value:createOrEditHeaders[e]}))),i.init({containerId:"additional-header-list",name:"openIdConnectClaimsMappings",keyName:"HeaderKey",valueName:"HeaderValue",items:o})},this.save=function(){var t={};i.getValues().forEach(e=>{t[e.key]=e.value});var o={id:e.getModal().find("input[name=Id]").val(),webhookUri:e.getModal().find("#webhookEndpointURL").val(),webhooks:e.getModal().find("#Webhooks").val(),headers:t};e.setBusy(!0),createOrEditIsEdit?a.updateSubscription(o).done(function(){abp.notify.info(app.localize("SavedSuccessfully")),e.close(),abp.event.trigger("app.createOrEditWebhookSubscriptionModalSaved")}).always(function(){e.setBusy(!1)}):a.addSubscription(o).done(function(){abp.notify.info(app.localize("SavedSuccessfully")),e.close(),abp.event.trigger("app.createOrEditWebhookSubscriptionModalSaved")}).always(function(){e.setBusy(!1)})}};
$(function(){var e=$("#SubscriptionTable"),a=abp.services.app.webhookSubscription,t={create:abp.auth.hasPermission("Pages.Administration.WebhookSubscription.Create"),edit:abp.auth.hasPermission("Pages.Administration.WebhookSubscription.Edit"),changeActivity:abp.auth.hasPermission("Pages.Administration.WebhookSubscription.ChangeActivity"),detail:abp.auth.hasPermission("Pages.Administration.WebhookSubscription.Detail")},i=new app.ModalManager({viewUrl:abp.appPath+"App/WebhookSubscription/CreateModal",scriptUrl:abp.appPath+"view-resources/Areas/App/Views/WebhookSubscriptions/_CreateOrEditModal.js",modalClass:"CreateOrEditWebhookSubscriptionModal",cssClass:"scrollable-modal"}),o=e.DataTable({paging:!1,serverSide:!1,processing:!1,listAction:{ajaxFunction:a.getAllSubscriptions},columnDefs:[{className:"control responsive",orderable:!1,render:function(){return""},targets:0},{targets:1,data:null,orderable:!1,defaultContent:"",visible:t.detail,rowAction:{element:$("<button/>").addClass("btn btn-sm btn-primary").text(app.localize("Details")).click(function(){var e;(e=$(this).data().id)&&(window.location="/App/WebhookSubscription/Detail/"+e)})}},{targets:2,data:"webhookUri"},{targets:3,data:"webhooks",render:function(e){var a="";if(e&&e.length>0)for(var t=0;t<e.length;t++){if(t>2)return a+=". . .";a+=e[t]+"<br/>"}return a}},{targets:4,data:"isActive",render:function(e){var a=$("<span/>").addClass("label");return e?a.addClass("label label-success label-inline").text(app.localize("Yes")):a.addClass("label label-dark label-inline").text(app.localize("No")),a[0].outerHTML}}]});function n(){o.ajax.reload()}$("#CreateNewWebhookSubscription").click(function(){i.open()}),$("#GetSubscriptionsButton").click(function(e){e.preventDefault(),n()}),abp.event.on("app.createOrEditWebhookSubscriptionModalSaved",function(){n()})});
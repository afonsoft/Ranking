!function(e){e.validator.addMethod("tenancyNameRegex",function(e,n,t){return t.test(e)},app.localize("TenantName_Regex_Description")),app.modals.CreateTenantModal=function(){var n,t=abp.services.app.tenant,i=null,a=new app.PasswordComplexityHelper;this.init=function(t){var r=(n=t).getModal();(i=r.find("form[name=TenantInformationsForm]")).validate({rules:{TenancyName:{tenancyNameRegex:new RegExp(i.find("input[name=TenancyName]").attr("regex"))}}});var s=r.find("input[name=AdminPassword],input[name=AdminPasswordRepeat]"),o=s.closest(".form-group");a.setPasswordComplexityRules(s,window.passwordComplexitySetting),e("#CreateTenant_SetRandomPassword").change(function(){e(this).is(":checked")?(o.slideUp("fast"),s.removeAttr("required")):(o.slideDown("fast"),s.attr("required","required"))});var d=r.find("input[name=ConnectionString]"),c=d.closest(".form-group");e("#CreateTenant_UseHostDb").change(function(){e(this).is(":checked")?(c.slideUp("fast"),d.removeAttr("required")):(c.slideDown("fast"),d.attr("required","required"))}),r.find(".date-time-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});var l=r.find("input[name=SubscriptionEndDateUtc]").parent("div"),p=r.find("#CreateTenant_IsUnlimited"),u=r.find("input[name=SubscriptionEndDateUtc]");function f(){p.is(":checked")?(l.slideUp("fast"),u.removeAttr("required")):(l.slideDown("fast"),u.attr("required","required"))}var m=r.find("#CreateTenant_IsInTrialPeriod").closest("div"),v=r.find("#CreateTenant_IsInTrialPeriod");function g(){p.is(":checked")?(m.slideUp("fast"),v.prop("checked",!1)):m.slideDown("fast")}p.change(function(){f(),g()});var h=r.find("#EditionId");h.change(function(){var n="True"===e("option:selected",this).attr("data-isfree");""===e("option:selected",this).val()||n?(r.find(".subscription-component").slideUp("fast"),n?p.prop("checked",!0):p.prop("checked",!1)):(p.prop("checked",!1),f(),g(),r.find(".subscription-component").slideDown("fast"))}),f(),g(),h.trigger("change")},this.save=function(){if(i.valid()){var a=i.serializeFormToObject();e("#CreateTenant_IsUnlimited").is(":visible")&&!e("#CreateTenant_IsUnlimited").is(":checked")?a.SubscriptionEndDateUtc=e(".date-time-picker").data("DateTimePicker").date().format("YYYY-MM-DDTHH:mm:ss")+"Z":a.SubscriptionEndDateUtc=null,e("#CreateTenant_IsUnlimited").is(":checked")&&(a.IsInTrialPeriod=!1),a.SetRandomPassword&&(a.Password=null,a.AdminPassword=null),a.UseHostDb&&(a.ConnectionString=null),n.setBusy(!0),t.createTenant(a).done(function(){abp.notify.info(app.localize("SavedSuccessfully")),n.close(),abp.event.trigger("app.createTenantModalSaved")}).always(function(){n.setBusy(!1)})}}}}(jQuery);
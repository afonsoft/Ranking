$(function(){var t=$("#NotificationsTable"),e=abp.services.app.notification,a=$("#TargetValueFilterSelectionCombobox");a.selectpicker();var i=new app.UserNotificationHelper,n={startDate:moment().startOf("day").subtract(7,"days"),endDate:moment().endOf("day")};$(document).find("input.date-range-picker").daterangepicker($.extend(!0,app.createDateRangePickerOptions(),n),function(t,e){n.startDate=t.format("YYYY-MM-DDT00:00:00Z"),n.endDate=e.format("YYYY-MM-DDT23:59:59.999Z"),s()});var o=function(t,a){var n=$("<span/>"),o=$("<button/>").addClass("btn btn-sm btn-icon btn-primary").attr("title",app.localize("SetAsRead")).click(function(e){var n,r;e.preventDefault(),n=a,r=function(){o.find("i").removeClass("la-circle-o").addClass("la-check"),o.attr("disabled","disabled"),t.closest("tr").addClass("notification-read")},i.setAsRead(n.id,function(){r&&r()})}).appendTo(n),r=$("<button/>").addClass("btn btn-sm btn-icon btn-danger").attr("title",app.localize("Delete")).click(function(){var t;t=a,abp.message.confirm(app.localize("NotificationDeleteWarningMessage"),app.localize("AreYouSure"),function(a){a&&e.deleteNotification({id:t.id}).done(function(){s(),abp.notify.success(app.localize("SuccessfullyDeleted"))})})}).appendTo(n);$('<i class="la la-remove" >').appendTo(r);var c=$('<i class="la" >').appendTo(o),l=i.format(a).state;"READ"===l&&(o.attr("disabled","disabled"),c.addClass("la-check")),"UNREAD"===l&&c.addClass("la-circle-o"),t.append(n)},r=t.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:e.getUserNotifications,inputFilter:function(){return{state:a.val(),startDate:n.startDate,endDate:n.endDate}}},columnDefs:[{className:"control responsive",orderable:!1,render:function(){return""},targets:0},{targets:1,data:null,orderable:!1,defaultContent:"",createdCell:function(t,e,a,i,n){o($(t),a)}},{targets:2,data:"severity",render:function(t,e,a,i){var n=app.notification.getUiIconBySeverity(a.notification.severity),o=app.notification.getIconFontClassBySeverity(a.notification.severity),r=$("<span></span>"),c=$(`<i class="${n} ${o} fa-2x" data-toggle="tooltip" data-placement="right" data-container="body" data-original-title="${function(t){switch(t){case abp.notifications.severity.SUCCESS:return app.localize("Success");case abp.notifications.severity.WARN:return app.localize("Warning");case abp.notifications.severity.ERROR:return app.localize("Error");case abp.notifications.severity.FATAL:return app.localize("Fatal");case abp.notifications.severity.INFO:default:return app.localize("Info")}}(a.notification.severity)}"></i>`);return r.append(c),r[0].outerHTML}},{targets:3,data:"notification",render:function(t,e,a,n){var o=i.format(a,!1),r=c(o);return(o.url&&"#"!==o.url?$('<a title="'+o.text+'" href="'+o.url+'" class="'+r+'">'+abp.utils.truncateStringWithPostfix(o.text,120)+"</a>"):$('<span title="'+o.text+'" class="'+r+'">'+abp.utils.truncateStringWithPostfix(o.text,120)+"</span>"))[0].outerHTML}},{targets:4,data:"creationTime",render:function(t,e,a,n){var o=i.format(a),r=c(o);return $('<span title="'+moment(a.notification.creationTime).format("llll")+'" class="'+r+'">'+o.timeAgo+"</span> &nbsp;")[0].outerHTML}}],initComplete:function(t,e){KTApp.initTooltips()}});function c(t){return"READ"===t.state?"notification-read":""}function s(){r.ajax.reload()}a.change(function(){s()}),$("#RefreshNotificationTableButton").click(function(t){t.preventDefault(),s()}),$("#btnOpenNotificationSettingsModal").click(function(t){i.openSettingsModal()}),$("#btnSetAllNotificationsAsRead").click(function(t){t.preventDefault(),i.setAllAsRead(function(){s()})}),$("#DeleteAllNotificationsButton").click(function(t){t.preventDefault(),abp.message.confirm(app.localize("DeleteListedNotificationsWarningMessage"),app.localize("AreYouSure"),function(t){t&&e.deleteAllUserNotifications({state:a.val(),startDate:n.startDate,endDate:n.endDate}).done(function(){s(),abp.notify.success(app.localize("SuccessfullyDeleted"))})})})});
$(function(){var e=abp.services.app.tenantSettings,t=$("#GeneralSettingsForm [name=Timezone]").val(),i=$("#GeneralSettingsForm [name=TimezoneForComparison]").val()===abp.setting.values["Abp.Timing.TimeZone"],n=new KeyValueListManager,o=new KeyValueListManager,a=$("#EmailSmtpSettingsForm").serializeFormToObject(),s=$("#FormBasedRegistrationSettingsForm").find("#Setting_AllowSelfRegistration_Content"),l=$("#FormBasedRegistrationSettingsForm").find(".divSessionTimeOut");function r(){$("#Setting_AllowSelfRegistration").is(":checked")?s.slideDown("fast"):s.slideUp("fast")}function c(){$("#Setting_IsSessionTimeOutEnabled").is(":checked")?l.slideDown("fast"):l.slideUp("fast")}$("#Settings_UseHostDefaultEmailSettings").change(function(){this.checked?$(".Settings_Email_Group").slideUp():$(".Settings_Email_Group").slideDown()}),$("#Setting_AllowSelfRegistration").change(function(){r()}),r(),c();var p=$("#EmailSmtpSettingsForm").find("input[name=SmtpDomain],input[name=SmtpUserName],input[name=SmtpPassword]").closest(".form-group");function d(){$("#Settings_SmtpUseDefaultCredentials").is(":checked")?p.slideUp("fast"):p.slideDown("fast")}$("#Settings_SmtpUseDefaultCredentials").change(function(){d()}),$("#Setting_IsSessionTimeOutEnabled").change(function(){c()}),d();var g=$("#LdapSettingsForm").find("input[name=Domain],input[name=UserName],input[name=Password]").closest(".form-group");function m(){$("#Setting_LdapIsEnabled").is(":checked")?g.slideDown("fast"):g.slideUp("fast")}m(),$("#Setting_LdapIsEnabled").change(function(){m()});var S=$("#UserLockOutSettingsForm").find("input").not("#Setting_UserLockOut_IsEnabled").closest(".form-group");function u(){$("#Setting_UserLockOut_IsEnabled").is(":checked")?S.slideDown("fast"):S.slideUp("fast")}u(),$("#Setting_UserLockOut_IsEnabled").change(function(){u()});var _=$("#TwoFactorLoginSettingsForm").find("input").not("#Setting_TwoFactorLogin_IsEnabled").closest(".checkbox");function f(){$("#Setting_TwoFactorLogin_IsEnabled").is(":checked")?_.slideDown("fast"):_.slideUp("fast")}function F(){var e=$("#DefaultPasswordComplexitySettingsForm input:disabled");e.removeAttr("disabled");var t=$("#DefaultPasswordComplexitySettingsForm").serializeFormToObject();e.attr("disabled","disabled");var i=$("#DefaultPasswordComplexitySettingsForm input:checkbox");return i.closest("checkbox"),i.addClass("disabled"),t}function h(e){$(".brand-logo").attr("src",e)}function v(e){$("#TenantCustomCss").remove(),e&&$("head").append('<link id="TenantCustomCss" href="'+e+'" rel="stylesheet"/>')}f(),$("#Setting_TwoFactorLogin_IsEnabled").change(function(){f()}),$("#Setting_PasswordComplexity_UseDefaultSettings").change(function(e){$(this).prop("checked")?$("#PasswordComplexitySettingsForm").hide("fast",function(){$("#DefaultPasswordComplexitySettingsForm").show("fast")}):$("#DefaultPasswordComplexitySettingsForm").hide("fast",function(){$("#PasswordComplexitySettingsForm").show("fast")})}),$("#SettingsLogoUploadForm").ajaxForm({beforeSubmit:function(e,t,i){var n=$("#SettingsLogoUploadForm input[name=ApplicationLogoImage]").get()[0].files;if(!n.length)return!1;var o=n[0],a="|"+o.type.slice(o.type.lastIndexOf("/")+1)+"|";return-1==="|jpg|jpeg|png|gif|".indexOf(a)?(abp.message.warn(app.localize("File_Invalid_Type_Error")),!1):!(o.size>30720&&(abp.message.warn(app.localize("File_SizeLimit_Error")),1))},success:function(e){e.success?(h(abp.appPath+"TenantCustomization/GetLogo?tenantId="+e.result.tenantId+"&t="+(new Date).getTime()),abp.notify.info(app.localize("SavedSuccessfully"))):abp.message.error(e.error.message)}}),$("#SettingsLogoUploadForm button[type=reset]").click(function(){e.clearLogo().done(function(){h(abp.appPath+"Common/Images/app-logo-on-light.svg"),abp.notify.info(app.localize("ClearedSuccessfully"))})}),$("#SettingsCustomCssUploadForm").ajaxForm({beforeSubmit:function(e,t,i){var n=$("#SettingsCustomCssUploadForm input[name=CustomCssFile]").get()[0].files;if(!n.length)return!1;var o=n[0],a="|"+o.type.slice(o.type.lastIndexOf("/")+1)+"|";return-1==="|css|".indexOf(a)?(abp.message.warn(app.localize("File_Invalid_Type_Error")),!1):!(o.size>1048576&&(abp.message.warn(app.localize("File_SizeLimit_Error")),1))},success:function(e){e.success?(v(abp.appPath+"TenantCustomization/GetCustomCss?tenantId="+e.result.tenantId),abp.notify.info(app.localize("SavedSuccessfully"))):abp.message.error(e.error.message)}}),$("#SettingsCustomCssUploadForm button[type=reset]").click(function(){e.clearCustomCss().done(function(){v(null),abp.notify.info(app.localize("ClearedSuccessfully"))})}),$("#SaveAllSettingsButton").click(function(){if(!$("#EmailSmtpSettingsForm").length||$("#EmailSmtpSettingsForm").valid()){var s=$.extend($("#FormBasedRegistrationSettingsForm").serializeFormToObject(),$("#UserManagementOtherSettingsForm").serializeFormToObject());s.sessionTimeOutSettings={isEnabled:$("#Setting_IsSessionTimeOutEnabled").is(":checked"),timeOutSecond:$("#Setting_SessionTimeOutSecond").val(),showTimeOutNotificationSecond:$("#Setting_ShowTimeOutNotificationSecond").val(),showLockScreenWhenTimedOut:$("#Setting_ShowLockScreenWhenTimedOut").is(":checked")},e.updateAllSettings({general:$("#GeneralSettingsForm").serializeFormToObject(),userManagement:s,email:$("#EmailSmtpSettingsForm").serializeFormToObject(),ldap:$("#LdapSettingsForm").serializeFormToObject(),billing:$("#BillingSettingsForm").serializeFormToObject(),otherSettings:$("#OtherSettingsForm").serializeFormToObject(),security:{useDefaultPasswordComplexitySettings:$("#Setting_PasswordComplexity_UseDefaultSettings").is(":checked"),passwordComplexity:$("#PasswordComplexitySettingsForm").serializeFormToObject(),defaultPasswordComplexity:F(),userLockOut:$("#UserLockOutSettingsForm").serializeFormToObject(),twoFactorLogin:$("#TwoFactorLoginSettingsForm").serializeFormToObject(),AllowOneConcurrentLoginPerUser:$("#Setting_AllowOneConcurrentLoginPerUser").is(":checked")},externalLoginProviderSettings:{facebook_IsDeactivated:$("#Setting_Facebook_IsDeactivated").prop("checked"),facebook:{appId:$("#Setting_Facebook_AppId").val(),appSecret:$("#Setting_Facebook_AppSecret").val()},google_IsDeactivated:$("#Setting_Google_IsDeactivated").prop("checked"),google:{clientId:$("#Setting_Google_ClientId").val(),clientSecret:$("#Setting_Google_ClientSecret").val(),userInfoEndpoint:$("#Setting_Google_UserInfoEndpoint").val()},twitter_IsDeactivated:$("#Setting_Twitter_IsDeactivated").prop("checked"),twitter:{consumerKey:$("#Setting_Twitter_ConsumerKey").val(),consumerSecret:$("#Setting_Twitter_ConsumerSecret").val()},microsoft_IsDeactivated:$("#Setting_Microsoft_IsDeactivated").prop("checked"),microsoft:{clientId:$("#Setting_Microsoft_ClientId").val(),clientSecret:$("#Setting_Microsoft_ClientSecret").val()},openIdConnect_IsDeactivated:$("#Setting_OpenIdConnect_IsDeactivated").prop("checked"),openIdConnect:{clientId:$("#Setting_OpenIdConnect_ClientId").val(),clientSecret:$("#Setting_OpenIdConnect_ClientSecret").val(),authority:$("#Setting_OpenIdConnect_Authority").val(),validateIssuer:$("#Setting_OpenIdConnect_ValidateIssuer").prop("checked")},openIdConnectClaimsMapping:n.getValues().map(e=>({key:e.key,claim:e.value})),wsFederation_IsDeactivated:$("#Setting_WsFederation_IsDeactivated").prop("checked"),wsFederation:{clientId:$("#Setting_WsFederation_ClientId").val(),tenant:$("#Setting_WsFederation_Tenant").val(),metaDataAddress:$("#Setting_WsFederation_MetaDataAddress").val(),wtrealm:$("#Setting_WsFederation_Wtrealm").val(),authority:$("#Setting_WsFederation_Authority").val()},wsFederationClaimsMapping:o.getValues().map(e=>({key:e.key,claim:e.value}))}}).done(function(){abp.notify.info(app.localize("SavedSuccessfully"));var e=$("#GeneralSettingsForm [name=Timezone]").val();abp.clock.provider.supportsMultipleTimezone&&i&&t!==e&&abp.message.info(app.localize("TimeZoneSettingChangedRefreshPageNotification")).done(function(){window.location.reload()}),a=$("#EmailSmtpSettingsForm").serializeFormToObject()})}}),$("#SendTestEmailButton").click(function(){if($("#EmailSmtpSettingsTestForm").valid()){var t=$("#EmailSmtpSettingsForm").serializeFormToObject();JSON.stringify(a)!==JSON.stringify(t)?abp.message.confirm(app.localize("SendEmailWithSavedSettingsWarning"),app.localize("AreYouSure"),function(t){t&&e.sendTestEmail({emailAddress:$("#TestEmailAddressInput").val()}).done(function(){abp.notify.info(app.localize("TestEmailSentSuccessfully"))})}):e.sendTestEmail({emailAddress:$("#TestEmailAddressInput").val()}).done(function(){abp.notify.info(app.localize("TestEmailSentSuccessfully"))})}}),$(".passwordShowButton").click(function(){var e=$(this).data("id"),t=$("#"+e);t&&("password"===t[0].type?(t[0].type="text",$(this).find("i").removeClass("fa-eye"),$(this).find("i").addClass("fa-eye-slash"),$(this).find("span").text(app.localize("Hide"))):(t[0].type="password",$(this).find("i").removeClass("fa-eye-slash"),$(this).find("i").addClass("fa-eye"),$(this).find("span").text(app.localize("Show"))))}),n.init({containerId:"claimsMappingsContainer",name:"openIdConnectClaimsMappings",keyName:"ClaimKey",valueName:"ClaimValue",items:openIdConnectClaimsMappings.map(e=>({key:e.Key,value:e.Claim}))}),o.init({containerId:"Setting_WsFederation_ClaimsMappingsContainer",name:"wsFederationClaimsMappings",keyName:"ClaimKey",valueName:"ClaimValue",items:wsFederationClaimsMappings.map(e=>({key:e.Key,value:e.Claim}))}),$("#Setting_Microsoft_UseHostSettings").change(function(){$(this).prop("checked")?($("#Setting_Microsoft_ClientId").val(""),$("#Setting_Microsoft_ClientSecret").val(""),$("#ExternalLoginMicrosoftSettingsForm .collapse").collapse("hide"),$("#Setting_Microsoft_IsDeactivated").prop("checked",!1)):$("#ExternalLoginMicrosoftSettingsForm .collapse").collapse("show")}),$("#Setting_Twitter_UseHostSettings").change(function(){$(this).prop("checked")?($("#Setting_Twitter_ConsumerKey").val(""),$("#Setting_Twitter_ConsumerSecret").val(""),$("#ExternalLoginTwitterSettingsForm .collapse").collapse("hide"),$("#Setting_Twitter_IsDeactivated").prop("checked",!1)):$("#ExternalLoginTwitterSettingsForm .collapse").collapse("show")}),$("#Setting_Google_UseHostSettings").change(function(){$(this).prop("checked")?($("#Setting_Google_ClientId").val(""),$("#Setting_Google_ClientSecret").val(""),$("#Setting_Google_UserInfoEndpoint").val(""),$("#ExternalLoginGoogleSettingsForm .collapse").collapse("hide"),$("#Setting_Google_IsDeactivated").prop("checked",!1)):$("#ExternalLoginGoogleSettingsForm .collapse").collapse("show")}),$("#Setting_Facebook_UseHostSettings").change(function(){$(this).prop("checked")?($("#Setting_Facebook_AppId").val(""),$("#Setting_Facebook_AppSecret").val(""),$("#ExternalLoginFacebookSettingsForm .collapse").collapse("hide"),$("#Setting_Facebook_IsDeactivated").prop("checked",!1)):$("#ExternalLoginFacebookSettingsForm .collapse").collapse("show")}),$("#Setting_OpenIdConnect_UseHostSettings").change(function(){$(this).prop("checked")?($("#Setting_OpenIdConnect_ClientId").val(""),$("#Setting_OpenIdConnect_ClientSecret").val(""),$("#Setting_OpenIdConnect_Authority").val(""),$("#Setting_OpenIdConnect_ValidateIssuer").val(""),$("#ExternalLoginOpenIdConnectSettingsForm .collapse").collapse("hide"),$("#Setting_OpenIdConnect_IsDeactivated").prop("checked",!1)):$("#ExternalLoginOpenIdConnectSettingsForm .collapse").collapse("show")}),$("#Setting_WsFederation_UseHostSettings").change(function(){$(this).prop("checked")?($("#Setting_WsFederation_ClientId").val(""),$("#Setting_WsFederation_Tenant").val(""),$("#Setting_WsFederation_MetaDataAddress").val(""),$("#Setting_WsFederation_Authority").val(""),$("#Setting_WsFederation_Wtrealm").val(""),$("#ExternalLoginWsFederationSettingsForm .collapse").collapse("hide"),$("#Setting_WsFederation_IsDeactivated").prop("checked",!1)):$("#ExternalLoginWsFederationSettingsForm .collapse").collapse("show")}),$("#EmailSmtpSettingsForm").validate(),$("#EmailSmtpSettingsTestForm").validate()});
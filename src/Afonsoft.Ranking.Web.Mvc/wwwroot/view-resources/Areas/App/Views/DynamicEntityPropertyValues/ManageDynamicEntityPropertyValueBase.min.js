var ManageDynamicEntityPropertyValueBase=function(e){return function(){var t,a=abp.services.app.dynamicEntityPropertyValue,n=[],i={delete:abp.auth.hasPermission("Pages.Administration.DynamicEntityPropertyValue.Delete")};function p(n,p){var r=p.getView(n.selectedValues,n.allValuesInputTypeHas),y=e("<tr></tr>"),u=e("<td></td>");u.text(n.propertyName);var l=e("<td></td>").append(r);l.append(r);var s=e("<td></td>");if(i.delete){var c=e('<button class="btn btn-danger"></button>').text(app.localize("Delete")).click(function(){var e;e={dynamicPropertyName:n.dynamicPropertyName,dynamicEntityPropertyId:n.dynamicEntityPropertyId},abp.message.confirm(app.localize("DeleteDynamicEntityPropertyValueMessage",e.dynamicPropertyName),app.localize("AreYouSure"),function(n){n&&(abp.ui.setBusy(),a.cleanValues({dynamicEntityPropertyId:e.dynamicEntityPropertyId,entityId:t.entityId}).done(function(){abp.notify.success(app.localize("SuccessfullyDeleted")),"function"==typeof t.onDeleteValues&&t.onDeleteValues()}).always(function(){abp.ui.clearBusy()}))})});s.append(c)}return y.append(u),y.append(l),y.append(s),y}return{initialize:function(i){abp.ui.setBusy(),t=i,n=[],a.getAllDynamicEntityPropertyValues({entityFullName:i.entityFullName,entityId:i.entityId}).done(function(t){var a=e(i.bodyElement);if(!t||!t.items||0==t.items.length){var r=e("<tr></tr>"),y=e("<td class='text-center' colspan='3'></td>");return y.text(app.localize("ThereAreNoDynamicPropertiesMessage")),r.append(y),void a.append(r)}for(var u=0;u<t.items.length;u++){var l=t.items[u],s=abp.inputTypeProviders.getInputTypeInstance({inputType:l.inputType});a.append(p(l,s)),s.afterViewInitialized(),n.push({data:l,inputTypeManager:s})}}).always(function(){abp.ui.clearBusy()})},save:function(e){if(n){abp.ui.setBusy();for(var i=[],p=0;p<n.length;p++)i.push({entityId:t.entityId,dynamicEntityPropertyId:n[p].data.dynamicEntityPropertyId,values:n[p].inputTypeManager.getSelectedValues()});a.insertOrUpdateAllValues({Items:i}).done(function(){abp.notify.success(app.localize("SavedSuccessfully")),"function"==typeof e&&e()}).always(function(){abp.ui.clearBusy()})}}}}}(jQuery);
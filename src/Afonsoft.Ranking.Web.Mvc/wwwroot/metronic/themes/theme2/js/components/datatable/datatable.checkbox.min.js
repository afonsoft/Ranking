"use strict";!function(e){e.fn.KTDatatable=e.fn.KTDatatable||{},e.fn.KTDatatable.checkbox=function(t,s){var c={selectedAllRows:!1,selectedRows:[],unselectedRows:[],init:function(){c.selectorEnabled()&&(t.setDataSourceParam(s.vars.selectedAllRows,!1),t.stateRemove("checkbox"),s.vars.requestIds&&t.setDataSourceParam(s.vars.requestIds,!0),e(t).on("datatable-on-reloaded",function(){t.stateRemove("checkbox"),t.setDataSourceParam(s.vars.selectedAllRows,!1),c.selectedAllRows=!1,c.selectedRows=[],c.unselectedRows=[]}),c.selectedAllRows=t.getDataSourceParam(s.vars.selectedAllRows),e(t).on("datatable-on-layout-updated",function(s,o){o.table==e(t.wrap).attr("id")&&t.ready(function(){c.initVars(),c.initEvent(),c.initSelect()})}),e(t).on("datatable-on-check",function(s,o){o.forEach(function(e){c.selectedRows.push(e),c.unselectedRows=c.remove(c.unselectedRows,e)});var l={};l.selectedRows=e.unique(c.selectedRows),l.unselectedRows=e.unique(c.unselectedRows),t.stateKeep("checkbox",l)}),e(t).on("datatable-on-uncheck",function(s,o){o.forEach(function(e){c.unselectedRows.push(e),c.selectedRows=c.remove(c.selectedRows,e)});var l={};l.selectedRows=e.unique(c.selectedRows),l.unselectedRows=e.unique(c.unselectedRows),t.stateKeep("checkbox",l)}))},initEvent:function(){e(t.tableHead).find('.checkbox-all > [type="checkbox"]').click(function(o){if(c.selectedRows=c.unselectedRows=[],t.stateRemove("checkbox"),c.selectedAllRows=!!e(this).is(":checked"),!s.vars.requestIds){e(this).is(":checked")&&(c.selectedRows=e.makeArray(e(t.tableBody).find('.checkbox-single > [type="checkbox"]').map(function(t,s){return e(s).val()})));var l={};l.selectedRows=e.unique(c.selectedRows),t.stateKeep("checkbox",l)}t.setDataSourceParam(s.vars.selectedAllRows,c.selectedAllRows),e(t).trigger("datatable-on-click-checkbox",[e(this)])}),e(t.tableBody).find('.checkbox-single > [type="checkbox"]').click(function(o){var l=e(this).val();e(this).is(":checked")?(c.selectedRows.push(l),c.unselectedRows=c.remove(c.unselectedRows,l)):(c.unselectedRows.push(l),c.selectedRows=c.remove(c.selectedRows,l)),!s.vars.requestIds&&c.selectedRows.length<1&&e(t.tableHead).find('.checkbox-all > [type="checkbox"]').prop("checked",!1);var n={};n.selectedRows=c.selectedRows.filter(c.unique),n.unselectedRows=c.unselectedRows.filter(c.unique),t.stateKeep("checkbox",n),e(t).trigger("datatable-on-click-checkbox",[e(this)])})},unique:function(e,t,s){return s.indexOf(e)===t},initSelect:function(){c.selectedAllRows&&s.vars.requestIds?(t.hasClass("datatable-error")||e(t.tableHead).find('.checkbox-all > [type="checkbox"]').prop("checked",!0),t.setActiveAll(!0),c.unselectedRows.forEach(function(e){t.setInactive(e)})):(c.selectedRows.forEach(function(e){t.setActive(e)}),!t.hasClass("datatable-error")&&e(t.tableBody).find('.checkbox-single > [type="checkbox"]').not(":checked").length<1&&e(t.tableHead).find('.checkbox-all > [type="checkbox"]').prop("checked",!0))},selectorEnabled:function(){return e.grep(t.options.columns,function(e,t){return e.selector||!1})[0]},initVars:function(){var e=t.stateGet("checkbox");void 0!==e&&(c.selectedRows=e.selectedRows||[],c.unselectedRows=e.unselectedRows||[])},getSelectedId:function(o){if(c.initVars(),c.selectedAllRows&&s.vars.requestIds){void 0===o&&(o=s.vars.rowIds);var l=t.getObject(o,t.lastResponse)||[];return l.length>0&&c.unselectedRows.forEach(function(e){l=c.remove(l,parseInt(e))}),e.unique(l)}return c.selectedRows},remove:function(e,t){return e.filter(function(e){return e!==t})}};return t.checkbox=function(){return c},"object"==typeof s&&(s=e.extend(!0,{},e.fn.KTDatatable.checkbox.default,s),c.init.apply(this,[s])),t},e.fn.KTDatatable.checkbox.default={vars:{selectedAllRows:"selectedAllRows",requestIds:"requestIds",rowIds:"meta.rowIds"}}}(jQuery);